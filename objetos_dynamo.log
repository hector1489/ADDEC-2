import clr
import sys
import pythoncom
from Autodesk.AutoCAD.ApplicationServices import Application
from Autodesk.Civil.ApplicationServices import CivilApplication

clr.AddReference('AcMgd')
clr.AddReference('AcDbMgd')
clr.AddReference('AeccDbMgd')

def obtener_objetos_civil3d():
    """Obtiene alineaciones y otros objetos de Civil 3D"""
    acad = None
    civil3d = None
    objetos_info = []

    try:
        pythoncom.CoInitialize()

        acad = Application.DocumentManager.MdiActiveDocument
        if acad is None:
            return "No se pudo conectar a AutoCAD."

        civil3d = CivilApplication.GetApplication()
        if civil3d is None:
            return "No se pudo obtener Civil 3D."

        civil_doc = civil3d.ActiveDocument
        alignments = civil_doc.AlignmentsSiteless
        surfaces = civil_doc.Surfaces

        # Obtener alineaciones
        for alignment in alignments:
            objetos_info.append({
                "Tipo": "Alineaci√≥n",
                "Nombre": alignment.Name,
                "Longitud": alignment.Length,
            })

        # Obtener superficies
        for surface in surfaces:
            objetos_info.append({
                "Tipo": "Superficie",
                "Nombre": surface.Name,
                "Estilo": surface.StyleName,
            })

        if not objetos_info:
            return "No se encontraron objetos."

        return objetos_info

    except Exception as e:
        return f"Error: {str(e)}"

    finally:
        pythoncom.CoUninitialize()

OUT = obtener_objetos_civil3d()
